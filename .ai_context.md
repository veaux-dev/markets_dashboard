# MarketDashboard AI Context

Este archivo define el contexto, arquitectura y reglas para agentes de IA que trabajen en este repositorio.

##  Contexto del Proyecto
MarketDashboard es un sistema modular de trading (Screener + Alertas) desarrollado en Python.
- **Desarrollador:** Single coder (el usuario).
- **Repositorio:** Privado en GitHub.

##  Infraestructura y Despliegue
- **Entorno:** Docker corriendo en un NAS gestionado por **Portainer**.
- **CI/CD:** 
  1. Commit + Push a GitHub.
  2. Portainer detecta cambios (polling o webhook).
  3. **Truco de Rebuild:** Para forzar que Portainer reconstruya la imagen (y ejecute `pip install` de nuevo), se debe modificar el archivo `build_stamp.txt`.
- **Almacenamiento:**
  - `data/`: Parquet (hist贸rico) y DuckDB (reciente/se帽ales). Montado como volumen.
  - `config/`: Archivos YAML/JSON. Montado como volumen.

##  Arquitectura Actual
El sistema tiene dos cerebros que se planean unificar:

1.  **Legacy (Cron-like):** `main_mkt_db.py`
    - Se ejecuta una vez y termina.
    - Gestiona alertas originales de Telegram/Discord.
    - Fuente de verdad: `config.yaml`.

2.  **Modern (Service):** `u2_screener_runner.py`
    - Loop infinito (`time.sleep`).
    - Genera el sitio web est谩tico (HTML/JSON) en `out/`.
    - Fuente de verdad: `config/u2_screener_config.json` (separada).

##  Roadmap (Objetivos) - FASE 2: "The Funnel"
Estamos migrando hacia una arquitectura V2 m谩s escalable y eficiente para hardware limitado (i5-2500k).

### Arquitectura "The Funnel"
1.  **Nivel 1 (Broad):** Escaneo diario de 500+ tickers (Universo). Datos 1d. Filtros baratos.
2.  **Nivel 2 (Detailed):** Monitoreo intrad铆a (1h/15m) de Watchlist + Candidatos Nivel 1. Alertas tiempo real.
3.  **Nivel 3 (Deep):** Visualizaci贸n on-demand (Triple Screen).

### Estrategia T茅cnica V2
- **Base de Datos:** DuckDB 煤nico (`markets.duckdb`).
  - Tabla `ohlcv` unificada para todos los TF.
  - Tabla `indicators` persistente para evitar rec谩lculo.
  - L贸gica incremental (UPSERT) para descargas.
- **Configuraci贸n:** `config/settings_v2.yaml` unificado y tipado.
- **Orquestaci贸n:** `runner_v2.py` modular.
- **Legacy:** Se mantiene `main_mkt_db.py` y `u2_screener_runner.py` intocables hasta que V2 est茅 lista (Blue/Green).

##  Reglas de Oro para la IA
1.  **No romper Producci贸n:** El sistema corre 24/7 en el NAS. Cambios en `docker-compose.yml` o estructura de carpetas deben ser validados.
2.  **Secretos:** NUNCA escribir tokens o claves en el c贸digo. Usar variables de entorno o `config/secrets.env`.
3.  **Paths:** Usar siempre `pathlib` y rutas relativas o basadas en `BASE_DIR`.
4.  **Eficiencia:** DuckDB single-writer. Evitar loops O(N) innecesarios. Cuidar API de Yahoo (caching).
