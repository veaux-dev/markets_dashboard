# MarketDashboard AI Context

Este archivo define el contexto, arquitectura y reglas para agentes de IA que trabajen en este repositorio.

##  Contexto del Proyecto
MarketDashboard es un sistema modular de trading (Screener + Alertas) desarrollado en Python.
- **Desarrollador:** Single coder (el usuario).
- **Entorno de Edici贸n:** PC Local (5800X + RTX5080ti) accesando archivos v铆a NFS.
- **Entorno de Ejecuci贸n:** Docker en TrueNAS Scale.

##  Infraestructura y Despliegue
- **CI/CD:** Commit + Push -> Portainer Rebuild.
- **Truco de Rebuild:** Modificar `build_stamp.txt` para forzar `pip install`.
- **Desarrollo Local:** 
  - Usar `DB_PATH_OVERRIDE=data/test_markets.duckdb` para no cargar la DB de 3GB.
  - Ejecutar con `uvicorn svc_v2.api:app --reload` para iterar r谩pido.

##  Arquitectura V2 (The Funnel)
1.  **Nivel 1 (Broad):** Escaneo diario (1d). `jobs/broad_scan.py`.
2.  **Nivel 2 (Detailed):** Monitoreo intrad铆a (1h/15m) de Watchlist VIP. `jobs/detailed_scan.py`.
3.  **Nivel 3 (Deep):** Visualizaci贸n on-demand. `static/triple_screen.html`.

##  Esquema DuckDB Clave
- `ohlcv`: Precios crudos. (1d normalizado a 00:00:00).
- `indicators`: Indicadores t茅cnicos calculados.
- `dynamic_watchlist`: Candidatos calientes (3 d铆as de vida).
- `portfolio_transactions`: Ledger de compras/ventas.
- `signal_history`: Registro de notificaciones enviadas (Cooldown 6h).

##  Reglas de Oro para la IA
1.  **No romper Producci贸n:** El sistema corre 24/7.
2.  **UTC Naive:** La DB guarda en UTC. La API convierte a ISO format con 'Z'.
3.  **JSON Compliance:** Siempre usar `df.astype(object).where(pd.notnull(df), None)` para limpiar NaNs/Infs antes de devolver JSON.
4.  **SQL Estricto:** Usar alias expl铆citos en `VALUES` y `JOINs` para evitar errores de Binder en DuckDB.